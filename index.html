<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce User Management Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .config-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .config-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .config-input label {
            min-width: 100px;
            font-weight: 600;
            color: #555;
        }

        .config-input input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .response-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            max-height: 400px;
            overflow-y: auto;
        }

        .response-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
        }

        .success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .token-display {
            background: #fff3cd;
            border-left-color: #ffc107;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 12px;
            word-break: break-all;
        }

        .token-display strong {
            display: block;
            margin-bottom: 5px;
            color: #856404;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .info-card h4 {
            margin-bottom: 10px;
        }

        .info-card ul {
            list-style: none;
            padding-left: 0;
        }

        .info-card li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .info-card li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ E-Commerce User Management</h1>
            <p>Complete User Management System - Step 1</p>
            <div style="margin-top: 10px;">
                <span id="connectionStatus" class="status-badge status-disconnected">‚ö†Ô∏è Not Connected</span>
            </div>
        </div>

        <!-- API Configuration -->
        <div class="config-section">
            <h3>‚öôÔ∏è API Configuration</h3>
            <div class="config-input">
                <label>Base URL:</label>
                <input type="text" id="apiBaseUrl" value="http://localhost:8000" />
                <button class="btn" onclick="testConnection()">Test Connection</button>
            </div>
        </div>

        <!-- Info Card -->
        <div class="info-card">
            <h4>üìã Default Test Accounts</h4>
            <div class="grid-2">
                <div>
                    <strong>Admin:</strong>
                    <ul>
                        <li>Email: admin@ecommerce.com</li>
                        <li>Password: Admin@123</li>
                    </ul>
                </div>
                <div>
                    <strong>Customer:</strong>
                    <ul>
                        <li>Email: customer1@example.com</li>
                        <li>Password: Customer@123</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('register')">üìù Register</button>
            <button class="tab-btn" onclick="openTab('login')">üîê Login</button>
            <button class="tab-btn" onclick="openTab('profile')">üë§ Profile</button>
            <button class="tab-btn" onclick="openTab('change-password')">üîë Change Password</button>
            <button class="tab-btn" onclick="openTab('users-list')">üìã Users List</button>
        </div>

        <!-- Register Tab -->
        <div id="register" class="tab-content active">
            <h2>Create New User Account</h2>
            <form onsubmit="registerUser(event)">
                <div class="grid-2">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" id="reg_first_name" required />
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" id="reg_last_name" required />
                    </div>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="reg_email" required />
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="reg_phone" placeholder="01712345678" />
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" id="reg_password" required />
                    </div>
                    <div class="form-group">
                        <label>Confirm Password *</label>
                        <input type="password" id="reg_password_confirm" required />
                    </div>
                </div>
                <button type="submit" class="btn">Register User</button>
            </form>
            <div id="register_response" class="response-box" style="display:none;"></div>
        </div>

        <!-- Login Tab -->
        <div id="login" class="tab-content">
            <h2>Login to Account</h2>
            <form onsubmit="loginUser(event)">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="login_email" value="customer1@example.com" required />
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" id="login_password" value="Customer@123" required />
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
            <div id="login_response" class="response-box" style="display:none;"></div>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <h2>User Profile</h2>
            <button class="btn" onclick="getProfile()">Load Profile</button>
            <button class="btn" onclick="showUpdateForm()" style="margin-left: 10px;">Update Profile</button>
            
            <div id="profile_view" style="display:none; margin-top: 20px;">
                <div class="response-box"></div>
            </div>

            <div id="profile_update" style="display:none; margin-top: 20px;">
                <form onsubmit="updateProfile(event)">
                    <div class="grid-2">
                        <div class="form-group">
                            <label>First Name</label>
                            <input type="text" id="upd_first_name" />
                        </div>
                        <div class="form-group">
                            <label>Last Name</label>
                            <input type="text" id="upd_last_name" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="upd_phone" />
                    </div>
                    <h4>Address Information</h4>
                    <div class="form-group">
                        <label>Address Line 1</label>
                        <input type="text" id="upd_address1" />
                    </div>
                    <div class="form-group">
                        <label>Address Line 2</label>
                        <input type="text" id="upd_address2" />
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>City</label>
                            <input type="text" id="upd_city" />
                        </div>
                        <div class="form-group">
                            <label>Postal Code</label>
                            <input type="text" id="upd_postal" />
                        </div>
                    </div>
                    <button type="submit" class="btn">Update Profile</button>
                </form>
            </div>
            <div id="profile_response" class="response-box" style="display:none;"></div>
        </div>

        <!-- Change Password Tab -->
        <div id="change-password" class="tab-content">
            <h2>Change Password</h2>
            <form onsubmit="changePassword(event)">
                <div class="form-group">
                    <label>Current Password *</label>
                    <input type="password" id="old_password" required />
                </div>
                <div class="form-group">
                    <label>New Password *</label>
                    <input type="password" id="new_password" required />
                </div>
                <div class="form-group">
                    <label>Confirm New Password *</label>
                    <input type="password" id="new_password_confirm" required />
                </div>
                <button type="submit" class="btn">Change Password</button>
            </form>
            <div id="password_response" class="response-box" style="display:none;"></div>
        </div>

        <!-- Users List Tab -->
        <div id="users-list" class="tab-content">
            <h2>Users List</h2>
            <button class="btn" onclick="getUsersList()">Load Users</button>
            <div id="users_response" class="response-box" style="display:none; margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        // Global variables
        let accessToken = localStorage.getItem('accessToken') || '';
        let refreshToken = localStorage.getItem('refreshToken') || '';

        // Test API connection
        async function testConnection() {
            const baseUrl = document.getElementById('apiBaseUrl').value;
            const statusBadge = document.getElementById('connectionStatus');
            
            try {
                const response = await fetch(`${baseUrl}/swagger.json`);
                if (response.ok) {
                    statusBadge.className = 'status-badge status-connected';
                    statusBadge.textContent = '‚úì Connected';
                    showNotification('Connection successful!', 'success');
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                statusBadge.className = 'status-badge status-disconnected';
                statusBadge.textContent = '‚ö†Ô∏è Connection Failed';
                showNotification('Cannot connect to API. Make sure server is running.', 'error');
            }
        }

        // API Helper
        function getApiUrl() {
            return document.getElementById('apiBaseUrl').value;
        }

        async function apiCall(endpoint, method = 'GET', body = null, useAuth = false) {
            const headers = {
                'Content-Type': 'application/json',
            };

            if (useAuth && accessToken) {
                headers['Authorization'] = `Bearer ${accessToken}`;
            }

            const options = {
                method,
                headers,
            };

            if (body && (method === 'POST' || method === 'PATCH' || method === 'PUT')) {
                options.body = JSON.stringify(body);
            }

            const response = await fetch(`${getApiUrl()}${endpoint}`, options);
            const data = await response.json();
            
            return { response, data };
        }

        // Tab switching
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Show notification
        function showNotification(message, type) {
            alert(message);
        }

        // Display response
        function displayResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = isError ? 'response-box error' : 'response-box success';
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        // Register User
        async function registerUser(event) {
            event.preventDefault();
            
            const data = {
                email: document.getElementById('reg_email').value,
                password: document.getElementById('reg_password').value,
                password_confirm: document.getElementById('reg_password_confirm').value,
                first_name: document.getElementById('reg_first_name').value,
                last_name: document.getElementById('reg_last_name').value,
                phone: document.getElementById('reg_phone').value,
            };

            try {
                const { response, data: resData } = await apiCall('/api/users/register/', 'POST', data);
                
                if (response.ok) {
                    accessToken = resData.tokens.access;
                    refreshToken = resData.tokens.refresh;
                    localStorage.setItem('accessToken', accessToken);
                    localStorage.setItem('refreshToken', refreshToken);
                    displayResponse('register_response', resData, false);
                    showNotification('Registration successful!', 'success');
                } else {
                    displayResponse('register_response', resData, true);
                }
            } catch (error) {
                displayResponse('register_response', { error: error.message }, true);
            }
        }

        // Login User
        async function loginUser(event) {
            event.preventDefault();
            
            const data = {
                email: document.getElementById('login_email').value,
                password: document.getElementById('login_password').value,
            };

            try {
                const { response, data: resData } = await apiCall('/api/users/login/', 'POST', data);
                
                if (response.ok) {
                    accessToken = resData.tokens.access;
                    refreshToken = resData.tokens.refresh;
                    localStorage.setItem('accessToken', accessToken);
                    localStorage.setItem('refreshToken', refreshToken);
                    displayResponse('login_response', resData, false);
                    showNotification('Login successful!', 'success');
                } else {
                    displayResponse('login_response', resData, true);
                }
            } catch (error) {
                displayResponse('login_response', { error: error.message }, true);
            }
        }

        // Get Profile
        async function getProfile() {
            if (!accessToken) {
                showNotification('Please login first!', 'error');
                return;
            }

            try {
                const { response, data: resData } = await apiCall('/api/users/profile/', 'GET', null, true);
                
                const viewDiv = document.getElementById('profile_view');
                viewDiv.style.display = 'block';
                
                if (response.ok) {
                    viewDiv.querySelector('.response-box').className = 'response-box success';
                    viewDiv.querySelector('.response-box').innerHTML = `<pre>${JSON.stringify(resData, null, 2)}</pre>`;
                } else {
                    viewDiv.querySelector('.response-box').className = 'response-box error';
                    viewDiv.querySelector('.response-box').innerHTML = `<pre>${JSON.stringify(resData, null, 2)}</pre>`;
                }
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        // Show Update Form
        function showUpdateForm() {
            document.getElementById('profile_update').style.display = 'block';
        }

        // Update Profile
        async function updateProfile(event) {
            event.preventDefault();
            
            if (!accessToken) {
                showNotification('Please login first!', 'error');
                return;
            }

            const data = {
                first_name: document.getElementById('upd_first_name').value,
                last_name: document.getElementById('upd_last_name').value,
                phone: document.getElementById('upd_phone').value,
                profile: {
                    address_line_1: document.getElementById('upd_address1').value,
                    address_line_2: document.getElementById('upd_address2').value,
                    city: document.getElementById('upd_city').value,
                    postal_code: document.getElementById('upd_postal').value,
                }
            };

            try {
                const { response, data: resData } = await apiCall('/api/users/profile/', 'PATCH', data, true);
                
                if (response.ok) {
                    displayResponse('profile_response', resData, false);
                    showNotification('Profile updated successfully!', 'success');
                } else {
                    displayResponse('profile_response', resData, true);
                }
            } catch (error) {
                displayResponse('profile_response', { error: error.message }, true);
            }
        }

        // Change Password
        async function changePassword(event) {
            event.preventDefault();
            
            if (!accessToken) {
                showNotification('Please login first!', 'error');
                return;
            }

            const data = {
                old_password: document.getElementById('old_password').value,
                new_password: document.getElementById('new_password').value,
                new_password_confirm: document.getElementById('new_password_confirm').value,
            };

            try {
                const { response, data: resData } = await apiCall('/api/users/change-password/', 'POST', data, true);
                
                if (response.ok) {
                    displayResponse('password_response', resData, false);
                    showNotification('Password changed successfully!', 'success');
                    event.target.reset();
                } else {
                    displayResponse('password_response', resData, true);
                }
            } catch (error) {
                displayResponse('password_response', { error: error.message }, true);
            }
        }

        // Get Users List
        async function getUsersList() {
            if (!accessToken) {
                showNotification('Please login first!', 'error');
                return;
            }

            try {
                const { response, data: resData } = await apiCall('/api/users/', 'GET', null, true);
                
                if (response.ok) {
                    displayResponse('users_response', resData, false);
                } else {
                    displayResponse('users_response', resData, true);
                }
            } catch (error) {
                displayResponse('users_response', { error: error.message }, true);
            }
        }

        // Test connection on page load
        window.onload = function() {
            testConnection();
        };
    </script>
</body>
</html>